var codeeditor={instances:[],current:null};codeeditor.text=JSON.parse(document.getElementsByTagName("meta")["xh-codeeditor"].content),codeeditor.getTextareasByClass=function(e){for(var o=document.getElementsByTagName("textarea"),r=new RegExp("(^|\\s)"+e+"(\\s|$)"),t=[],n=0,i=o.length;n<i;n++){var d=o[n];r.test(d.className)&&t.push(d)}return t},codeeditor.uniqueId=function(){for(var e="codeeditor",o=0;null!==document.getElementById(e+o);)o++;return e+o},codeeditor.hasSubmit=function(e){for(var o,r=e.elements,t=0,n=r.length;t<n;t++)if("type"in(o=r[t])&&"submit"==o.type)return!0;return!1},codeeditor.beforeUnload=function(e){for(var o=0,r=codeeditor.instances.length;o<r;o++)if(!codeeditor.instances[o].isClean())return void(e.returnValue=codeeditor.text.confirmLeave)},codeeditor.insertURI=function(e){var o=codeeditor.current;o.replaceSelection(e),o.focus()},codeeditor.instantiateByClasses=function(e,o,r){for(var t,n,i,d,c=0,s=e.length;c<s;c++)for(i=0,n=(t=codeeditor.getTextareasByClass(e[c])).length;i<n;i++)(d=t[i]).id||(d.id=codeeditor.uniqueId()),codeeditor.instantiate(d.id,o,r)},codeeditor.instantiate=function(e,o,r){var e=document.getElementById(e),t=e.offsetHeight,o=CodeMirror.fromTextArea(e,o);o.cmbMayPreview=r||!1,o.setSize(null,t),o.on("focus",function(e){codeeditor.current=e}),o.refresh(),codeeditor.instances.push(o),CodeMirror.on(window,"beforeunload",codeeditor.beforeUnload),CodeMirror.on(e.form,"submit",function(){CodeMirror.off(window,"beforeunload",codeeditor.beforeUnload)})},CodeMirror.commands.save=function(e){var e=e.getTextArea().form,o=document.createElement("input");o.setAttribute("type","submit"),e.appendChild(o),o.click(),e.removeChild(o)},CodeMirror.commands.toggleFullscreen=function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},CodeMirror.commands.togglePreview=function(e){var o,r=e.getWrapperElement();e.cmbMayPreview&&(r.previousSibling&&0<=r.previousSibling.className.indexOf("codeeditor_preview")?((o=r.previousSibling).parentNode.removeChild(o),e.setOption("onBlur",null),e.cmbFullscreen&&(delete e.cmbFullscreen,CodeMirror.commands.toggleFullscreen(e))):(0<=e.getScrollerElement().className.indexOf("codeeditor_fullscreen")&&(CodeMirror.commands.toggleFullscreen(e),e.cmbFullscreen=!0),(o=document.createElement("div")).className="codeeditor_preview",o.innerHTML=e.getValue(),r.parentNode.insertBefore(o,r),e.setOption("onBlur",function(){CodeMirror.commands.togglePreview(e)})))},CodeMirror.commands.toggleFolding=function(e){e.foldCode(e.getCursor())},CodeMirror.commands.toogleLineWrapping=function(e){e.setOption("lineWrapping",!e.getOption("lineWrapping"))},CodeMirror.commands.browseImages=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("images")},CodeMirror.commands.browseDownloads=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("downloads")},CodeMirror.commands.browseMedia=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("media")},CodeMirror.commands.browseUserfiles=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("userfiles")};