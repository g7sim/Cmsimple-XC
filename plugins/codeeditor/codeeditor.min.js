var codeeditor={instances:[],current:null,getTextareasByClass:function(e){for(var o=document.getElementsByTagName("textarea"),r=new RegExp("(^|\\s)"+e+"(\\s|$)"),n=[],t=0,i=o.length;t<i;t++)textarea=o[t],r.test(textarea.className)&&n.push(textarea);return n},uniqueId:function(){for(var e,o="codeeditor";null!==document.getElementById(o+e);)e++;return o+e},hasSubmit:function(e){for(var o=e.elements,r=0,n=o.length;r<n;r++)if("submit"==o[r].type)return!0;return!1},beforeUnload:function(e){for(var o=0,r=codeeditor.instances.length;o<r;o++)if(!codeeditor.instances[o].isClean())return e.returnValue=codeeditor.text.confirmLeave},insertURI:function(e){var o=codeeditor.current;o.replaceSelection(e),o.focus()},instantiateByClasses:function(e,o,r){for(var n,t,i,d,c=0,s=e.length;c<s;c++)for(i=0,t=(n=codeeditor.getTextareasByClass(e[c])).length;i<t;i++)(d=n[i]).id||(d.id=codeeditor.uniqueId()),codeeditor.instantiate(d.id,o,r)},instantiate:function(e,o,r){var n=document.getElementById(e),e=n.offsetHeight,o=CodeMirror.fromTextArea(n,o);o.cmbMayPreview=r||!1,o.setSize(null,e),o.on("focus",function(e){codeeditor.current=e}),o.refresh(),codeeditor.instances.push(o),CodeMirror.on(window,"beforeunload",codeeditor.beforeUnload),CodeMirror.on(n.form,"submit",function(){CodeMirror.off(window,"beforeunload",codeeditor.beforeUnload)})}};CodeMirror.commands.save=function(e){var o=e.getTextArea().form,e=document.createElement("input");e.setAttribute("type","submit"),o.appendChild(e),e.click(),o.removeChild(e)},CodeMirror.commands.toggleFullscreen=function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},CodeMirror.commands.togglePreview=function(e){var o,r=e.getWrapperElement();e.cmbMayPreview&&(r.previousSibling&&0<=r.previousSibling.className.indexOf("codeeditor_preview")?((o=r.previousSibling).parentNode.removeChild(o),e.setOption("onBlur",null),e.cmbFullscreen&&(delete e.cmbFullscreen,CodeMirror.commands.toggleFullscreen(e))):(0<=e.getScrollerElement().className.indexOf("codeeditor_fullscreen")&&(CodeMirror.commands.toggleFullscreen(e),e.cmbFullscreen=!0),(o=document.createElement("div")).className="codeeditor_preview",o.innerHTML=e.getValue(),r.parentNode.insertBefore(o,r),e.setOption("onBlur",function(){CodeMirror.commands.togglePreview(e)})))},CodeMirror.commands.toggleFolding=function(e){e.foldCode(e.getCursor())},CodeMirror.commands.toogleLineWrapping=function(e){e.setOption("lineWrapping",!e.getOption("lineWrapping"))},CodeMirror.commands.browseImages=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("images")},CodeMirror.commands.browseDownloads=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("downloads")},CodeMirror.commands.browseMedia=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("media")},CodeMirror.commands.browseUserfiles=function(e){"function"==typeof codeeditor.filebrowser&&codeeditor.filebrowser("userfiles")};